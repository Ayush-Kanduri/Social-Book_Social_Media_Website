//Export the Posts Controller's create() Function
module.exports.create = async (req, res) => {
	try {
		let post = await Post.create({
			content: req.body.content,
			//We have Already Set the Authenticated User in the Request Object
			user: req.user._id,
		});

		//We need to check if the request is AJAX or not.
		//The type of AJAX Request is XMLHttpRequest (XHR)
		//It returns the Data in JSON format as a Response to the AJAX Call which made the Request.
		if (req.xhr) {
			try {
				//If we want to populate just the name of the user (we don't not want to send the password in the API), this is how we do it!
				// post = await post.populate("user");
				// post = await post.populate("user", "name");
				post = await post.populate("user", ["name", "avatar"]);

				//Return JSON with a status of 200(Success) because the post is created.
				return res.status(200).json({
					data: {
						post: post,
						user: req.user,
					},
					message: "Post Created !!!",
				});
			} catch (err) {
				console.log("Error: ", err);
				return res.status(500).json({
					data: {
						error: err,
					},
					message: "Error in Creating Post !!!",
				});
			}
		}

		//If the request is made through normal Request (Not AJAX)
		req.flash("success", "Post Published !!!");
		return res.redirect("back");
	} catch (err) {
		req.flash("error", err);
		return res.redirect("back");
	}
};