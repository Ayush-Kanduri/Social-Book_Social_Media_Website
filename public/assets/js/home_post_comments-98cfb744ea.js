class PostComments{constructor(t){this.postId=t,this.postContainer=$(`#post-${t}`),this.newCommentForm=$(`#post-${t}-comments-form`),this.createComment(t);let e=this;$(" .delete-comment-button",this.postContainer).each((function(){e.deleteComment($(this))}))}createComment(t){let e=this;this.newCommentForm.submit((function(n){n.preventDefault();let o=this;$.ajax({type:"POST",url:"/comments/create",data:$(o).serialize(),success:function(n){let s=e.newCommentDom(n.data.comment,n.data.user);$(`#post-comments-${t}`).prepend(s),$(o).trigger("reset"),e.deleteComment($(" .delete-comment-button",s)),new ToggleLike($(" .toggle-like-button",s)),new Noty({theme:"relax",text:"Comment published!",type:"success",layout:"topRight",timeout:3e3}).show()},error:function(t){console.log(t.responseText)}})}))}newCommentDom(t,e){let n,o,s,i=[];try{n=t.user.avatar?`<img\n\t\t\t\t\t\t\t\t\tclass="user-avatar"\n\t\t\t\t\t\t\t\t\tsrc="${t.user.avatar}"\n\t\t\t\t\t\t\t\t\talt="${t.user.name}"\n\t\t\t\t\t\t\t\t\tonclick="window.location.href='/users/profile/${t.user._id}'"\n\t\t\t\t\t\t\t\t\tloading="lazy"\n\t\t\t\t\t\t\t\t/>`:`<img\n\t\t\t\t\t\t\t\t\tclass="user-avatar"\n\t\t\t\t\t\t\t\t\tsrc="<%= assetPath('images/empty-avatar.png') %>"\n\t\t\t\t\t\t\t\t\talt="${t.user.name}"\n\t\t\t\t\t\t\t\t\tonclick="window.location.href='/users/profile/${t.user._id}'"\n\t\t\t\t\t\t\t\t\tloading="lazy"\n\t\t\t\t\t\t\t\t/>`,o=e.id==t.user.id?`<small>\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\tclass="delete-comment-button"\n\t\t\t\t\t\t\t\t\thref="/comments/delete/${t._id}"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<i class="fa-solid fa-trash"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</small>`:"",i=t.likes.filter((e=>e.user._id.toString()===locals.user._id.toString()&&"Comment"===e.onModel&&t._id.toString()===e.likeable._id.toString())),s=i.length>0?`<a\n\t\t\t\thref="/likes/toggle/?id=${t._id}&type=Comment"\n\t\t\t\tclass="like toggle-like-button comment-like-button"\n\t\t\t\tdata-likes="0"\n\t\t\t\tstyle="color: rgb(255, 0, 0)"\n\t\t\t>\n\t\t\t\t<i class="fa-solid fa-thumbs-up"></i>\n\t\t\t\t&ensp;<span>0 Like</span>\n\t\t\t</a>`:`<a\n\t\t\t\thref="/likes/toggle/?id=${t._id}&type=Comment"\n\t\t\t\tclass="like toggle-like-button comment-like-button"\n\t\t\t\tdata-likes="0"\n\t\t\t\tstyle="color: #b8fff9"\n\t\t\t>\n\t\t\t\t<i class="fa-solid fa-thumbs-up"></i>\n\t\t\t\t&ensp;<span>0 Like</span>\n\t\t\t</a>`}catch(t){console.log(t)}return $(`<li id="comment-${t._id}" class="post-comments-li">\n\t<div class="comment">\n\t\t<div class="comment-heading">\n\t\t\t${n}\n\t\t\t<p class="comment-info">\n\t\t\t\t<small\n\t\t\t\t\tonclick="window.location.href='/users/profile/${t.user._id}'"\n\t\t\t\t\t>${t.user.name}</small\n\t\t\t\t>\n\t\t\t\t<small>${this.printPostDate(t.updatedAt)}</small>\n\t\t\t</p>\n\t\t\t${o}\n\t\t</div>\n\t\t<div class="comment-content">\n\t\t\t<p>${t.content}</p>\n\t\t</div>\n\t\t<div class="comment-react">\n\t\t\t${s}\n\t\t</div>\n\t</div>\n</li>\n`)}printPostDate(t){let e=t;e=new Date(e);const n=e.getDate(),o=e.getFullYear();return n+" "+e.toLocaleString("default",{month:"short"})+", "+o+" | "+e.toLocaleTimeString("default",{hour:"2-digit",minute:"2-digit"})}deleteComment(t){$(t).click((function(e){e.preventDefault(),$.ajax({type:"get",url:$(t).prop("href"),success:function(t){$(`#comment-${t.data.comment_id}`).remove(),new Noty({theme:"relax",text:"Comment Deleted",type:"success",layout:"topRight",timeout:3e3}).show()},error:function(t){console.log(t.responseText)}})}))}}